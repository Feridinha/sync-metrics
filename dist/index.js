"use strict";

var _database = _interopRequireDefault(require("./database"));
var _axios = _interopRequireDefault(require("axios"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const fetchLogs = async () => {
  console.log("Fetching", Date.now());
  const response = await _axios.default.get(`https://syncc.feridinha.com/rooms`).catch(console.error);
  if (!response) return;
  const rooms = response.data.data;
  const models = rooms.map(room => ({
    channel: room.name,
    channel_id: room.id,
    users: room.stats.users,
    videos: room.stats.videos
  }));
  await _database.default.log.createMany({
    data: models
  }).catch(err => console.log("Query error:", err));
};
fetchLogs();
setInterval(fetchLogs, 30 * 1000);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfZGF0YWJhc2UiLCJfaW50ZXJvcFJlcXVpcmVEZWZhdWx0IiwicmVxdWlyZSIsIl9heGlvcyIsIm9iaiIsIl9fZXNNb2R1bGUiLCJkZWZhdWx0IiwiZmV0Y2hMb2dzIiwiY29uc29sZSIsImxvZyIsIkRhdGUiLCJub3ciLCJyZXNwb25zZSIsImF4aW9zIiwiZ2V0IiwiY2F0Y2giLCJlcnJvciIsInJvb21zIiwiZGF0YSIsIm1vZGVscyIsIm1hcCIsInJvb20iLCJjaGFubmVsIiwibmFtZSIsImNoYW5uZWxfaWQiLCJpZCIsInVzZXJzIiwic3RhdHMiLCJ2aWRlb3MiLCJkYXRhYmFzZSIsImNyZWF0ZU1hbnkiLCJlcnIiLCJzZXRJbnRlcnZhbCJdLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZGF0YWJhc2UgZnJvbSBcIi4vZGF0YWJhc2VcIlxyXG5pbXBvcnQgYXhpb3MgZnJvbSBcImF4aW9zXCJcclxuXHJcbmludGVyZmFjZSBSZXNwb25zZSB7XHJcbiAgICBkYXRhOiB7XHJcbiAgICAgICAgbmFtZTogc3RyaW5nXHJcbiAgICAgICAgcHJvZmlsZV9pbWFnZTogc3RyaW5nXHJcbiAgICAgICAgZGlzcGxheV9uYW1lOiBzdHJpbmdcclxuICAgICAgICBpZDogc3RyaW5nXHJcbiAgICAgICAgc3RhdHM6IHtcclxuICAgICAgICAgICAgdmlkZW9zOiBudW1iZXJcclxuICAgICAgICAgICAgdXNlcnM6IG51bWJlclxyXG4gICAgICAgIH1cclxuICAgIH1bXVxyXG59XHJcblxyXG5jb25zdCBmZXRjaExvZ3MgPSBhc3luYyAoKSA9PiB7XHJcbiAgICBjb25zb2xlLmxvZyhcIkZldGNoaW5nXCIsIERhdGUubm93KCkpXHJcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGF4aW9zXHJcbiAgICAgICAgLmdldDxSZXNwb25zZT4oYGh0dHBzOi8vc3luY2MuZmVyaWRpbmhhLmNvbS9yb29tc2ApXHJcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXHJcblxyXG4gICAgaWYgKCFyZXNwb25zZSkgcmV0dXJuXHJcblxyXG4gICAgY29uc3Qgcm9vbXMgPSByZXNwb25zZS5kYXRhLmRhdGFcclxuXHJcbiAgICBjb25zdCBtb2RlbHMgPSByb29tcy5tYXAoKHJvb20pID0+ICh7XHJcbiAgICAgICAgY2hhbm5lbDogcm9vbS5uYW1lLFxyXG4gICAgICAgIGNoYW5uZWxfaWQ6IHJvb20uaWQsXHJcbiAgICAgICAgdXNlcnM6IHJvb20uc3RhdHMudXNlcnMsXHJcbiAgICAgICAgdmlkZW9zOiByb29tLnN0YXRzLnZpZGVvcyxcclxuICAgIH0pKVxyXG5cclxuICAgIGF3YWl0IGRhdGFiYXNlLmxvZ1xyXG4gICAgICAgIC5jcmVhdGVNYW55KHsgZGF0YTogbW9kZWxzIH0pXHJcbiAgICAgICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUubG9nKFwiUXVlcnkgZXJyb3I6XCIsIGVycikpXHJcbn1cclxuXHJcbmZldGNoTG9ncygpXHJcbnNldEludGVydmFsKGZldGNoTG9ncywgMzAgKiAxMDAwKVxyXG4iXSwibWFwcGluZ3MiOiI7O0FBQUEsSUFBQUEsU0FBQSxHQUFBQyxzQkFBQSxDQUFBQyxPQUFBO0FBQ0EsSUFBQUMsTUFBQSxHQUFBRixzQkFBQSxDQUFBQyxPQUFBO0FBQXlCLFNBQUFELHVCQUFBRyxHQUFBLFdBQUFBLEdBQUEsSUFBQUEsR0FBQSxDQUFBQyxVQUFBLEdBQUFELEdBQUEsS0FBQUUsT0FBQSxFQUFBRixHQUFBO0FBZXpCLE1BQU1HLFNBQVMsR0FBRyxNQUFBQSxDQUFBLEtBQVk7RUFDMUJDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLFVBQVUsRUFBRUMsSUFBSSxDQUFDQyxHQUFHLENBQUMsQ0FBQyxDQUFDO0VBQ25DLE1BQU1DLFFBQVEsR0FBRyxNQUFNQyxjQUFLLENBQ3ZCQyxHQUFHLENBQVksbUNBQWtDLENBQUMsQ0FDbERDLEtBQUssQ0FBQ1AsT0FBTyxDQUFDUSxLQUFLLENBQUM7RUFFekIsSUFBSSxDQUFDSixRQUFRLEVBQUU7RUFFZixNQUFNSyxLQUFLLEdBQUdMLFFBQVEsQ0FBQ00sSUFBSSxDQUFDQSxJQUFJO0VBRWhDLE1BQU1DLE1BQU0sR0FBR0YsS0FBSyxDQUFDRyxHQUFHLENBQUVDLElBQUksS0FBTTtJQUNoQ0MsT0FBTyxFQUFFRCxJQUFJLENBQUNFLElBQUk7SUFDbEJDLFVBQVUsRUFBRUgsSUFBSSxDQUFDSSxFQUFFO0lBQ25CQyxLQUFLLEVBQUVMLElBQUksQ0FBQ00sS0FBSyxDQUFDRCxLQUFLO0lBQ3ZCRSxNQUFNLEVBQUVQLElBQUksQ0FBQ00sS0FBSyxDQUFDQztFQUN2QixDQUFDLENBQUMsQ0FBQztFQUVILE1BQU1DLGlCQUFRLENBQUNwQixHQUFHLENBQ2JxQixVQUFVLENBQUM7SUFBRVosSUFBSSxFQUFFQztFQUFPLENBQUMsQ0FBQyxDQUM1QkosS0FBSyxDQUFFZ0IsR0FBRyxJQUFLdkIsT0FBTyxDQUFDQyxHQUFHLENBQUMsY0FBYyxFQUFFc0IsR0FBRyxDQUFDLENBQUM7QUFDekQsQ0FBQztBQUVEeEIsU0FBUyxDQUFDLENBQUM7QUFDWHlCLFdBQVcsQ0FBQ3pCLFNBQVMsRUFBRSxFQUFFLEdBQUcsSUFBSSxDQUFDIn0=